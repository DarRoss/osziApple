# OsziApple: Bad Apple!! on the Signalis Oscilloscope
## Instructions

### Achtung Achtung (Important)
Generating the CSharp file requires Linux, but building the DLL file require Visual Studio, which requires Windows.\
Windows users may install *WSL* to compile the CSharp file.\
Linux users are out of luck when it comes to building the DLL file.\
Apologies for this organizational disaster.

### Dependencies
Visual Studio 2022 is required to build the DLL file. Your Visual Studio will need the ".NET Framework 4.8" component alongside the ".NET desktop development" workload.\
[MelonLoader 0.5.7](https://melonwiki.xyz/#/) is required to run the built DLL file. Run Signalis at least once after installing MelonLoader in order to generate any necessary Unity assemblies.

The following packages are required to generate the CSharp file:
- `internetarchive`
- `p7zip-full`
- `imagemagick`
- `potrace`
- `g++`

On Debian-based distributions, install the above dependencies as follows: 
```
apt-get install internetarchive p7zip-full imagemagick potrace g++
```

### Generating the MelonLoader CSharp File (in Linux)
Download and extract Bad Apple frame data from the Internet Archive. 
```
ia download --no-directories bad_apple_is.7z bad_apple_is.7z
7za x bad_apple_is.7z
```
Pad an extra zero to the first 999 images in the image sequence. 
```
for i in {001..999}; do mv image_sequence/$i.png image_sequence/0$i.png; done
```
Convert each frame PNG into a BMP file, then convert into an SVG file using Potrace. 
```
mkdir svgs
for i in {0001..6562}; do convert image_sequence/$i.png -threshold 95% bmp:- | potrace -s -o svgs/$i.svg; done
```
Compile and run the CSharp file generator. 
```
make
./osziApple
```
This will create the file `OsziApple.cs`.

### Building the MelonLoader DLL File (in Windows)
1. Open the file `OsziAppleMod.csproj` in a text editor. Replace the phrase '[SIGNALIS GAME DIRECTORY ABSOLUTE PATH]' with the absolute path of your Signalis game folder. 
2. Open Visual Studio. Create a project of the following: Class Library .NET Framework 4.8. Name this project "OsziAppleMod".
3. Remove the file `Class1.cs` from the project directory.
4. Move 'OsziApple.cs' and 'OsziAppleMod.csproj' into the project directory.
5. Move 'AssemblyInfo.cs' into the Properties directory.
6. Build the project.
7. The built DLL file `OsziAppleMod.dll` is located in `[PROJECT DIRECTORY]\bin\Debug\net48\`.

### Running Bad Apple in Signalis
1. Copy and paste the built DLL file into `[SIGNALIS GAME DIRECTORY]/Mods/`.
2. Boot up the game and visit the oscilloscope room in Nowhere. The game will freeze for several minutes. Please wait patiently while the animation loads. 
3. Watch Bad Apple play in slow motion on the oscilloscope.

## Writeup
In Signalis, the oscilloscope tracer resides at some point in 3D space, where it repeatedly plays its current animation.\
Every time Unity decides to update the tracer, a trail is drawn between its current and previous position.\
An orthographic camera records this trail and "broadcasts" the recording to the oscilloscope screen.\
By moving the tracer behind the camera (outside the boundaries of its view frustum), 
we prevent the trail generated by the tracer from appearing on the oscilloscope screen.\
This allows us to move our tracer to a different curve without drawing a trail, simulating disjoint curves.\
This method is not foolproof, as the frequency of tracer updates is affected by lag spikes and other external factors. 

## Special thanks to the following:
- Cristiferbeast for sharing his Visual Studio setup. 
- rose-engine for creating Signalis.
